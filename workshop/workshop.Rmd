---
title: "workshop"
author: "Daniel Suh"
date: "`r Sys.Date()`"
output: html_document
---

```{r, message=F}
library(tidyverse)
library(magrittr)
library(here)
library(ggridges)
```



read data
```{r, message = F}
dat <- read_csv(here("workshop/microsporidians.csv"))

seq_dat <- read_csv(here("data/Microsporidia ID for Alex Strauss - All Samples.csv"))
```

```{r}
seq_dat %<>% mutate(Key = `Sample ID`)

dat %<>% full_join(., seq_dat, by = join_by(Key, Lake, `Avg. Count`, Spores))

dat %<>% filter(!is.na(Key)) %>% filter(!is.na(colnames(.[1]))) %>% filter(!is.na(Species)) %>% select(-colnames(.[1]))
```


Average spore yield per host species for all parasite species
```{r}
yield <- dat %>% mutate(log_spores = log(Spores)) %>% 
  group_by(Species) %>% 
  summarize(mean = mean(log_spores),
            var = var(log_spores),
            se = sd(log_spores)/sqrt(n()))
```


```{r}
yield %>% ggplot(.,aes(x=Species, y=mean, fill = Species)) + geom_col() + geom_errorbar(aes(ymin=mean-se, ymax=mean+se))
```




Site-months
```{r}
site_months <- dat %>% select(c(full_date:worm)) %>% group_by(st_date, lake_id) %>% distinct()

site_months %<>% mutate(abund = sum(c(dpa.ncount, dam.ncount, dla.ncount, sim.ncount, dia.ncount, cer.ncount, bos.ncount)),
                        inf = sum(c(dpa.ninfect, dam.ninfect, dla.ninfect, sim.ninfect, dia.ninfect, cer.ninfect, bos.ninfect)),
                        prev = inf/abund)

site_months %<>% filter(!lake_id %in% c("Oglethorpe", "NN1", "Memorial", "Chapman"))

site_months %>% ggplot(.,aes(x=jday_cum, y=lake_id, group=lake_id, fill=as.factor(lake_id), height = abund)) + 
  geom_density_ridges_gradient(show.legend = F, stat = "identity") + 
  labs(x = "Day", y ="Lake", title = "Abundance over time")

site_months %>% ggplot(.,aes(x=jday_cum, y=lake_id, group=lake_id, fill=as.factor(lake_id), height = inf)) + 
  geom_density_ridges_gradient(show.legend = F, stat = "identity") + 
  labs(x = "Day", y ="Lake", title = "Incidence over time")

site_months %>% ggplot(.,aes(x=jday_cum, y=lake_id, group=lake_id, fill=as.factor(lake_id), height = prev)) + 
  geom_density_ridges_gradient(show.legend = F, stat = "identity") + 
  labs(x = "Day", y ="Lake", title = "Prevalence over time")

```


```{r}

```

